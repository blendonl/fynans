model Store {
  id String @id @default(uuid())

  name     String
  location String

  items    StoreItem[]
  expenses Expense[]
  users    UserStore[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store")
}

model Item {
  id         String @id @default(uuid())
  categoryId String @map("category_id")

  name String @unique

  category ItemCategory @relation(fields: [categoryId], references: [id])
  stores   StoreItem[]
  users    UserItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("item")
}

model StoreItem {
  id      String @id @default(uuid())
  itemId  String @map("item_id")
  storeId String @map("store_id")

  price        Decimal
  isDiscounted Boolean @map("is_discounted")

  store     Store               @relation(fields: [storeId], references: [id])
  item      Item                @relation(fields: [itemId], references: [id])
  discounts StoreItemDiscount[]
  expenses  ExpenseItem[]
  users     UserStoreItem[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store_item")
}

model StoreItemDiscount {
  id          String @id
  storeItemId String @map("store_item_id")

  discount  Decimal
  startedAt DateTime  @default(now()) @map("started_at")
  endedAt   DateTime? @map("ended_at")

  storeItem StoreItem @relation(fields: [storeItemId], references: [id])

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("store_item_discount")
}

model ItemCategory {
  id       String  @id @default(uuid())
  parentId String? @map("parent_id")

  name String

  parent   ItemCategory?  @relation(name: "children", fields: [parentId], references: [id])
  children ItemCategory[] @relation(name: "children")
  items    Item[]
  users    UserItemCategory[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("item_category")
}

model UserStore {
  id      String @id @default(uuid())
  userId  String @map("user_id")
  storeId String @map("store_id")

  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  store Store @relation(fields: [storeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, storeId])
  @@index([userId])
  @@index([storeId])
  @@map("user_store")
}

model UserItem {
  id     String @id @default(uuid())
  userId String @map("user_id")
  itemId String @map("item_id")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  item Item @relation(fields: [itemId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, itemId])
  @@index([userId])
  @@index([itemId])
  @@map("user_item")
}

model UserStoreItem {
  id          String @id @default(uuid())
  userId      String @map("user_id")
  storeItemId String @map("store_item_id")

  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  storeItem StoreItem @relation(fields: [storeItemId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, storeItemId])
  @@index([userId])
  @@index([storeItemId])
  @@map("user_store_item")
}

model UserItemCategory {
  id         String @id @default(uuid())
  userId     String @map("user_id")
  categoryId String @map("category_id")

  user     User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  category ItemCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([userId, categoryId])
  @@index([userId])
  @@index([categoryId])
  @@map("user_item_category")
}
